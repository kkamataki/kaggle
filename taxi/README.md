## Script files for the kaggle taxi competition

This repository contains scripts that I used for the kaggle taxi prediction task. The Scripts in the initial commit are like for quick prototyping and hence have rooms for improvements (for example, many parameters and thresholds are hard-coded, which is usually not a good practice and there are some duplicated functionalities across the codes, which could be organized in better way).
Most of the scripts still don't perform much input and output data validation, which also should be improved.

[*1.filter_traindata.rb*](#filter_traindata.rb)
[*2.assign_cluster.rb*](#assign_cluster.rb)
[*3.assign_grid.rb*](#assign_grid.rb)

###Preprocessing Scripts

##### *1.filter_traindata.rb*
- **Input:** train.csv
- **Output:** filtered_train.csv, long_lat_filtered_1p.csv, long_1p.csv, lat_1p.csv, long_lat_1p.csv
- **Description:** A Ruby script which generates another training data set removing outlier trajectories.
This script also generates 1% sampled longitude/latitude pair data for quick data analysis and clustering
- **Sample usage:** `ruby ./filter_traindata.rb`

###Feature generators

##### *2. assign_cluster.rb*
- **Input:** filtered_train.csv(1)* or test.csv,
- **Output:** cluster_converted_{train|test}_supervised.csv
- **Arguments:** "train" or "test"
- **Description:** Reads training or test data and assigns cluster ID for each trip start location and trip end location (for training data) or just trip start location (for test data) in appropriate format for the supervised learning algorithms- **Sample usage:** `ruby ./assign_cluster.rb train`
- **Sample usage:** `ruby ./assign_cluster.rb train`
*(1) means the file is generated by the script 1.

##### *2-1. find_cluster.rb*
- **Input:** 50clusters.dat*
- **Description:** Internal library to be used by assign_cluster.rb. This scripts finds the nearest cluster centroid for a longitude/latitude coordinate pair.
The 50clusters.dat was generated by simply applying k-means algorithm to long_lat_filtered_1p.csv using R

*cluster centroids calculated by offline

##### *3. assign_grid.rb*
- **Input:** filtered_train.csv(1) or test.csv
- **Output:** grid_converted_{train|test}_lazy.csv
- **Arguments:** "train" or "test"
- **Description:** Reads training or test data and assigns grid location ID for each longitude/latitude coordinates in appropriate format for the lazy learning algorithms
- **Sample usage:** `ruby ./assign_grid.rb train`

##### *3-1. calc_grid.rb*
- **Description:** Internal library mainly to be used by assign_grid.rb. This scripts calculates location grid for a longitude/latitude coordinate pair.

##### *4. discretized_feat_generator.rb*
- **Input:** filtered_train.csv(1), test.csv, cluster_converted_train_supervised.csv(2), and cluster_converted_test_supervised.csv(2)
- **Output:** discretized_train_supervised.csv and discretized_test_supervised.csv
- **Description:** Converts categorical features (such as "CALL_TYPE" and "ORIGIN_CALL") into sequential integers so that the library "sklearn.preprocessing.OneHotEncoder" can process appropriately
- **Sample usage:** `ruby ./discretized_feat_generator.rb`

##### *4-1. feat_id_mapper.rb*
- **Description:** Internal library mainly to be used by discretized_feat_generator.rb. This script computes the actual integer to assign for each categorical feature value.

###Machine learning algorithm codes
##### *5. runrf.py*
- **Input:** discretized_train_supervised.csv(4) and discretized_test_supervised.csv(4)
- **Output:** rf_25p_prediction_result.dat
- **Description:** Runs random forest for the 25% sampled training data and make predictions
- **Sample usage:** `python ./runrf.py`

##### *6. rundnn.py*
- **Input:** discretized_train_supervised.csv(4) and discretized_test_supervised.csv(4)
- **Output:** dnn_05p_prediction_result.dat
- **Description:** Runs deep neural network for the 5% sampled training data and make predictions
- **Sample usage:** `python ./rundnn.py`

##### *7. run_lazy_path_finder.rb*
- **Input:** grid_converted_train_lazy.csv(3) and grid_converted_test_lazy.csv(3)
- **Output:** matched_geo_endpoints_less_than50.csv
- **Description:** Runs the lazy learning algorithm and generates at most 50 matching end grid ids in the training data set for each test trip
- **Sample usage:** `ruby ./run_lazy_path_finder.rb`

###Postprocessing scripts

##### *8. supervised_classification_postprocessor.rb*
- **Input:** rf_25p_prediction_result.dat(5) or dnn_05p_prediction_result.dat(6)
- **Output:** rf_25p_final_output.csv or dnn_05p_final_output.csv
- **Arguments:** Input filename, Output filename (input/output filename can be specified)
- **Description:** Converts the predicted clusters into longitude/latitude coordinate pair and format the data into Kaggle submission format
- **Sample usage:** `ruby ./supervised_classification_postprocessor.rb rf_25p_prediction_result.dat rf_25p_final_output.csv`

##### *9. lazy_path_finder_postprocessor.rb*
- **Input:** matched_geo_endpoints_less_than50.csv(7)
- **Output:** lazy_final_output.csv
- **Arguments:** Input filename, Output filename (input/output filename can be specified)
- **Description:** Calculates the average longitude/latitude coordinate of the matching end points for each test trip and format the data into Kaggle submission format
- **Sample usage:** `ruby ./lazy_path_finder_postprocessor.rb matched_geo_endpoints_less_than50.csv lazy_final_output.csv`

##### *10. get_weighted_average_corrdinates.rb*
- **Input:** rf_25p_final_output.csv(8) or dnn_05p_final_output.csv(8), and lazy_final_output.csv(9)
- **Output:** dnn05p_lessthan50_1_9_combined.csv(for example)
- **Arguments:** Input filename1, Input filename2, weight for the first input file, weight for the second input file, output filename
- **Description:** Calculates weighted average of longitude/latitude coordinates of supervised/lazy learning algorithm outputs for each trip with the Kaggle submission format
- **Sample usage:** `ruby ./get_weighted_average_corrdinates.rb dnn_05p_final_output.csv lazy_final_output.csv 1 9 dnn05p_lazylessthan50_1_9_combined.csv`

###Other data analysis scripts and miscellaneous

##### *11. find_popular_cluster.rb*
- **Input:** cluster_converted_train_supervised.csv(2) and 50clusters.dat
- **Arguments:** N(integer)
- **Description:** Prints out the longitude/latitude coordinates of the top N major cluster's centroids of each trip destinations in the training data set
- **Sample usage:** `ruby ./find_popular_cluster.rb 10`

##### *12. running_scripts_sample.sh*
- **Description:** Runs a set of scripts from 1 to 10 in this README
- **Sample usage:** `sh ./running_scripts_sample.sh`
